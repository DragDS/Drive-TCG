<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DRIVE Card Gallery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }
    body {
      margin: 0;
      background: #020617;
      color: #e5e7eb;
    }
    .app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.5rem;
    }
    header {
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }
    header h1 {
      margin: 0;
      font-size: 1.8rem;
    }
    header span {
      font-size: 0.95rem;
      color: #9ca3af;
    }

    .controls,
    .controls-secondary {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) repeat(3, minmax(0, 1fr));
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }
    .controls-secondary {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    @media (max-width: 900px) {
      .controls {
        grid-template-columns: minmax(0, 1.7fr) repeat(2, minmax(0, 1fr));
      }
      .controls-secondary {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
    @media (max-width: 700px) {
      .controls,
      .controls-secondary {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    input[type="text"],
    select {
      width: 100%;
      padding: 0.45rem 0.6rem;
      border-radius: 0.5rem;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 0.45rem 0.8rem;
      font-size: 0.85rem;
      cursor: pointer;
      background: #111827;
      color: #e5e7eb;
      border: 1px solid #374151;
      transition: background 0.1s ease, transform 0.05s ease,
        box-shadow 0.1s ease;
    }
    button:hover {
      background: #020617;
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.4);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
      gap: 1rem;
    }
    .card {
      background: #020617;
      border-radius: 0.75rem;
      border: 1px solid #1f2937;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: transform 0.12s ease, box-shadow 0.12s ease,
        border-color 0.12s ease;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
      cursor: pointer;
    }
    .card:hover {
      transform: translateY(-3px);
      border-color: #22c55e;
      box-shadow: 0 15px 35px rgba(34, 197, 94, 0.35);
    }
    .thumb {
      aspect-ratio: 3 / 4;
      background: #020617;
      overflow: hidden;
    }
    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .body {
      padding: 0.65rem 0.75rem 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    .title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
    }
    .title {
      font-size: 0.95rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .pill {
      font-size: 0.72rem;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      border: 1px solid #4b5563;
      color: #9ca3af;
      flex-shrink: 0;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .meta {
      font-size: 0.78rem;
      color: #9ca3af;
    }
    .notes {
      font-size: 0.8rem;
      color: #d1d5db;
      margin-top: 0.2rem;
      max-height: 2.6em;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .extra-line {
      font-size: 0.78rem;
      color: #e5e7eb;
    }
    .tag-line {
      font-size: 0.75rem;
      color: #9ca3af;
    }
    .tag-pill {
      display: inline-block;
      padding: 0.05rem 0.4rem;
      border-radius: 999px;
      border: 1px solid #374151;
      margin-right: 0.25rem;
      margin-top: 0.15rem;
    }
    .empty {
      border-radius: 0.75rem;
      border: 1px dashed #4b5563;
      padding: 1rem;
      text-align: center;
      font-size: 0.9rem;
      color: #6b7280;
      margin-top: 1rem;
    }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .modal {
      background: #020617;
      border-radius: 0.75rem;
      border: 1px solid #1f2937;
      max-width: 900px;
      width: 90%;
      max-height: 90vh;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 1rem;
      padding: 1rem;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
    }
    @media (max-width: 768px) {
      .modal {
        grid-template-columns: minmax(0, 1fr);
        max-height: 95vh;
      }
    }
    .modal-img {
      aspect-ratio: 3 / 4;
      background: #020617;
      overflow: hidden;
      border-radius: 0.5rem;
    }
    .modal-img img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .modal-body {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      font-size: 0.9rem;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-title {
      font-size: 1rem;
      font-weight: 600;
    }
    .modal-close {
      border: none;
      background: transparent;
      color: #9ca3af;
      font-size: 1.2rem;
      cursor: pointer;
    }
    .modal-close:hover {
      color: #ffffff;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>DRIVE Card Gallery</h1>
      <span>Official DRIVE TCG viewer</span>
    </header>

    <!-- Filters -->
    <div class="controls">
      <input type="text" id="searchInput" placeholder="Search…" />
      <select id="setFilter"><option value="">All Sets</option></select>
      <select id="typeFilter"><option value="">All Types</option></select>
      <select id="rarityFilter"><option value="">All Rarities</option></select>
    </div>

    <div class="controls-secondary">
      <select id="vehTypeFilter">
        <option value="">All Vehicle Types</option>
        <option>Drag</option>
        <option>Drift</option>
        <option>Off-Road</option>
        <option>Rally</option>
      </select>
      <select id="sortFilter">
        <option value="default">Sort: Default</option>
        <option value="name">Sort: Name A–Z</option>
        <option value="set">Sort: Set & Number</option>
        <option value="type">Sort: Type</option>
      </select>
      <button id="clearFiltersBtn">Clear Filters</button>
    </div>

    <div style="margin-bottom: 0.5rem; font-size: 0.82rem;">
      Cards found: <span id="cardCount">0</span>
    </div>

    <div id="grid" class="grid"></div>
    <div id="emptyState" class="empty" style="display:none;">
      No cards match your filters.
    </div>
  </div>

  <!-- Modal -->
  <div id="cardModal" class="modal-backdrop">
    <div class="modal">
      <div class="modal-img">
        <img id="modalImg" src="" alt="">
      </div>
      <div class="modal-body">
        <div class="modal-header">
          <div id="modalTitle" class="modal-title"></div>
          <button id="modalCloseBtn" class="modal-close">✕</button>
        </div>

        <div id="modalType" class="meta"></div>
        <div id="modalSet" class="meta"></div>
        <div id="modalRarity" class="meta"></div>
        <div id="modalExtra1" class="extra-line"></div>
        <div id="modalExtra2" class="extra-line"></div>
        <div id="modalExtra3" class="extra-line"></div>
        <div id="modalTags" class="tag-line"></div>
        <div id="modalNotes" class="notes"></div>
      </div>
    </div>
  </div>

  <script>
    let cards = [];

    const searchInput = document.getElementById("searchInput");
    const setFilter = document.getElementById("setFilter");
    const typeFilter = document.getElementById("typeFilter");
    const rarityFilter = document.getElementById("rarityFilter");
    const vehTypeFilter = document.getElementById("vehTypeFilter");
    const sortFilter = document.getElementById("sortFilter");
    const clearFiltersBtn = document.getElementById("clearFiltersBtn");

    const grid = document.getElementById("grid");
    const cardCount = document.getElementById("cardCount");
    const emptyState = document.getElementById("emptyState");

    const cardModal = document.getElementById("cardModal");
    const modalImg = document.getElementById("modalImg");
    const modalTitle = document.getElementById("modalTitle");
    const modalType = document.getElementById("modalType");
    const modalSet = document.getElementById("modalSet");
    const modalRarity = document.getElementById("modalRarity");
    const modalExtra1 = document.getElementById("modalExtra1");
    const modalExtra2 = document.getElementById("modalExtra2");
    const modalExtra3 = document.getElementById("modalExtra3");
    const modalTags = document.getElementById("modalTags");
    const modalNotes = document.getElementById("modalNotes");
    const modalCloseBtn = document.getElementById("modalCloseBtn");

    async function loadCards() {
      const res = await fetch("drive-card.json", { cache: "no-store" });
      cards = await res.json();
    }

    function populateFilters() {
      const sets = [...new Set(cards.map(c => c.setName).filter(Boolean))].sort();
      const types = [...new Set(cards.map(c => c.type).filter(Boolean))].sort();
      const rarities = [...new Set(cards.map(c => c.rarity).filter(Boolean))].sort();

      sets.forEach(s => setFilter.innerHTML += `<option>${s}</option>`);
      types.forEach(t => typeFilter.innerHTML += `<option>${t}</option>`);
      rarities.forEach(r => rarityFilter.innerHTML += `<option>${r}</option>`);
    }

    function matchesVehicleType(card, vt) {
      if (!vt) return true;
      const extra = card.extra || {};
      if (Array.isArray(extra.vehicleTypes) && extra.vehicleTypes.includes(vt)) return true;
      if (extra.vehicleType === vt) return true;
      return false;
    }

    function openModal(card) {
      const extra = card.extra || {};

      modalImg.src = card.imageData;
      modalTitle.textContent = card.name;
      modalType.textContent = card.type;
      modalSet.textContent = `${card.setName} • #${card.cardNumber}`;
      modalRarity.textContent = "Rarity: " + card.rarity;

      modalExtra1.textContent = "";
      modalExtra2.textContent = "";
      modalExtra3.textContent = "";

      let lines = [];

      if ((card.type === "Driver" || card.type === "Named Driver" || card.type === "Track") &&
          Array.isArray(extra.vehicleTypes)) {
        lines.push("Types: " + extra.vehicleTypes.join(", "));
      }

      if ((card.type === "Vehicle" || card.type === "Named Vehicle")) {
        lines.push(`Vehicle: ${extra.vehicleType} • HP/CON: ${extra.hp} / ${extra.con}`);
      }

      if (card.type === "Mod") {
        let t = "Base Part: " + extra.modBasePart;
        let lv = [extra.modLevel1,extra.modLevel2,extra.modLevel3,extra.modLevel4].filter(Boolean);
        if (lv.length) t += " • Lv: " + lv.join(" | ");
        lines.push(t);
      }

      modalExtra1.textContent = lines[0] || "";
      modalExtra2.textContent = lines[1] || "";
      modalExtra3.textContent = lines[2] || "";

      modalTags.innerHTML = "";
      if (card.tags) {
        card.tags.forEach(tag => {
          modalTags.innerHTML += `<span class="tag-pill">${tag}</span>`;
        });
      }

      modalNotes.textContent = card.notes || "";

      cardModal.style.display = "flex";
    }

    function closeModal() {
      cardModal.style.display = "none";
    }

    modalCloseBtn.onclick = closeModal;
    cardModal.onclick = e => { if (e.target === cardModal) closeModal(); };
    document.addEventListener("keydown", e => { if (e.key === "Escape") closeModal(); });

    function render() {
      let filtered = cards.slice();

      const q = searchInput.value.toLowerCase();
      const s = setFilter.value;
      const t = typeFilter.value;
      const r = rarityFilter.value;
      const vt = vehTypeFilter.value;

      if (s) filtered = filtered.filter(c => c.setName === s);
      if (t) filtered = filtered.filter(c => c.type === t);
      if (r) filtered = filtered.filter(c => c.rarity === r);
      filtered = filtered.filter(c => matchesVehicleType(c, vt));

      if (q) {
        filtered = filtered.filter(c => {
          const extra = c.extra || {};
          const text = (
            c.name + " " + 
            c.type + " " + 
            c.rarity + " " + 
            c.setName + " " +
            c.cardNumber + " " +
            c.notes + " " +
            (c.tags||[]).join(" ") + " " +
            JSON.stringify(extra)
          ).toLowerCase();
          return text.includes(q);
        });
      }

      if (sortFilter.value === "name")
        filtered.sort((a,b)=>a.name.localeCompare(b.name));
      if (sortFilter.value === "set")
        filtered.sort((a,b)=>a.setName.localeCompare(b.setName) || a.cardNumber.localeCompare(b.cardNumber));
      if (sortFilter.value === "type")
        filtered.sort((a,b)=>a.type.localeCompare(b.type) || a.name.localeCompare(b.name));

      cardCount.textContent = filtered.length;

      grid.innerHTML = "";
      if (!filtered.length) {
        emptyState.style.display = "block";
        return;
      }
      emptyState.style.display = "none";

      filtered.forEach(card => {
        const extra = card.extra || {};

        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <div class="thumb"><img src="${card.imageData}"></div>
          <div class="body">
            <div class="title-row">
              <div class="title">${card.name}</div>
              <div class="pill">${card.type}</div>
            </div>
            <div class="meta">${card.setName} • #${card.cardNumber}</div>
            <div class="meta">Rarity: ${card.rarity}</div>

            ${ (card.type==="Driver"||card.type==="Named Driver"||card.type==="Track") && extra.vehicleTypes
              ? `<div class="extra-line">Types: ${extra.vehicleTypes.join(", ")}</div>` : "" }

            ${ (card.type==="Vehicle"||card.type==="Named Vehicle")
              ? `<div class="extra-line">Vehicle: ${extra.vehicleType} • HP/CON: ${extra.hp} / ${extra.con}</div>` : "" }

            ${ card.type==="Mod" 
              ? `<div class="extra-line">Base Part: ${extra.modBasePart} • Lv: ${
                  [extra.modLevel1,extra.modLevel2,extra.modLevel3,extra.modLevel4]
                  .filter(Boolean).join(" | ")
                }</div>` : "" }

            <div class="tag-line">
              ${(card.tags||[]).map(t=>`<span class="tag-pill">${t}</span>`).join("")}
            </div>

            <div class="notes">${card.notes||""}</div>
          </div>
        `;

        el.onclick = () => openModal(card);
        grid.appendChild(el);
      });
    }

    function clearFilters() {
      searchInput.value = "";
      setFilter.value = "";
      typeFilter.value = "";
      rarityFilter.value = "";
      vehTypeFilter.value = "";
      sortFilter.value = "default";
      render();
    }

    clearFiltersBtn.onclick = clearFilters;

    async function init() {
      await loadCards();
      populateFilters();
      render();

      searchInput.oninput = render;
      setFilter.onchange = render;
      typeFilter.onchange = render;
      rarityFilter.onchange = render;
      vehTypeFilter.onchange = render;
      sortFilter.onchange = render;
    }

    init();
  </script>
</body>
</html>
