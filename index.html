<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DRIVE Card Gallery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }
    body {
      margin: 0;
      background: #020617;
      color: #e5e7eb;
    }
    .app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.5rem;
    }
    header {
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }
    header h1 {
      margin: 0;
      font-size: 1.8rem;
    }
    header span {
      font-size: 0.95rem;
      color: #9ca3af;
    }
    .controls {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) repeat(3, minmax(0, 1fr));
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    @media (max-width: 900px) {
      .controls {
        grid-template-columns: minmax(0, 1.7fr) repeat(2, minmax(0, 1fr));
      }
    }
    @media (max-width: 700px) {
      .controls {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    input[type="text"],
    select {
      width: 100%;
      padding: 0.45rem 0.6rem;
      border-radius: 0.5rem;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
      gap: 1rem;
    }
    .card {
      background: #020617;
      border-radius: 0.75rem;
      border: 1px solid #1f2937;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: transform 0.12s ease, box-shadow 0.12s ease,
        border-color 0.12s ease;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
      cursor: default;
    }
    .card:hover {
      transform: translateY(-3px);
      border-color: #22c55e;
      box-shadow: 0 15px 35px rgba(34, 197, 94, 0.35);
    }
    .thumb {
      aspect-ratio: 3 / 4;
      background: #020617;
      overflow: hidden;
    }
    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .body {
      padding: 0.65rem 0.75rem 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    .title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
    }
    .title {
      font-size: 0.95rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .pill {
      font-size: 0.72rem;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      border: 1px solid #4b5563;
      color: #9ca3af;
      flex-shrink: 0;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .meta {
      font-size: 0.78rem;
      color: #9ca3af;
    }
    .notes {
      font-size: 0.8rem;
      color: #d1d5db;
      margin-top: 0.2rem;
      max-height: 2.6em;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .extra-line {
      font-size: 0.78rem;
      color: #e5e7eb;
    }
    .tag-line {
      font-size: 0.75rem;
      color: #9ca3af;
    }
    .tag-pill {
      display: inline-block;
      padding: 0.05rem 0.4rem;
      border-radius: 999px;
      border: 1px solid #374151;
      margin-right: 0.25rem;
      margin-top: 0.15rem;
    }
    .empty {
      border-radius: 0.75rem;
      border: 1px dashed #4b5563;
      padding: 1rem;
      text-align: center;
      font-size: 0.9rem;
      color: #6b7280;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>DRIVE Card Gallery</h1>
      <span>Official DRIVE TCG viewer (reads drive-card.json exported from your admin).</span>
    </header>

    <div class="controls">
      <input
        type="text"
        id="searchInput"
        placeholder="Search by name, text, set, tags, base part, HP/CON…"
      />
      <select id="setFilter">
        <option value="">All Sets</option>
      </select>
      <select id="typeFilter">
        <option value="">All Types</option>
      </select>
      <select id="rarityFilter">
        <option value="">All Rarities</option>
      </select>
    </div>

    <div style="margin-bottom: 0.5rem; font-size: 0.82rem;">
      Cards found: <span id="cardCount">0</span>
    </div>

    <div id="grid" class="grid"></div>
    <div id="emptyState" class="empty" style="display:none;">
      No cards match your filters. Try clearing search or filters.
    </div>
  </div>

  <script>
    let cards = [];

    const searchInput = document.getElementById("searchInput");
    const setFilter = document.getElementById("setFilter");
    const typeFilter = document.getElementById("typeFilter");
    const rarityFilter = document.getElementById("rarityFilter");
    const grid = document.getElementById("grid");
    const cardCount = document.getElementById("cardCount");
    const emptyState = document.getElementById("emptyState");

    async function loadCards() {
      try {
        const res = await fetch("drive-card.json", { cache: "no-store" });
        if (!res.ok) throw new Error("Failed to load drive-card.json");
        const json = await res.json();
        if (!Array.isArray(json)) throw new Error("JSON is not an array");
        cards = json;
      } catch (err) {
        console.error(err);
        cards = [];
      }
    }

    function populateFilters() {
      const sets = Array.from(new Set(cards.map(c => c.setName).filter(Boolean))).sort((a,b) => a.localeCompare(b));
      const types = Array.from(new Set(cards.map(c => c.type).filter(Boolean))).sort((a,b) => a.localeCompare(b));
      const rarities = Array.from(new Set(cards.map(c => c.rarity).filter(Boolean))).sort((a,b) => a.localeCompare(b));

      setFilter.innerHTML = '<option value="">All Sets</option>';
      sets.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s;
        opt.textContent = s;
        setFilter.appendChild(opt);
      });

      typeFilter.innerHTML = '<option value="">All Types</option>';
      types.forEach(t => {
        const opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t;
        typeFilter.appendChild(opt);
      });

      rarityFilter.innerHTML = '<option value="">All Rarities</option>';
      rarities.forEach(r => {
        const opt = document.createElement("option");
        opt.value = r;
        opt.textContent = r;
        rarityFilter.appendChild(opt);
      });
    }

    function render() {
      const q = searchInput.value.trim().toLowerCase();
      const setVal = setFilter.value;
      const typeVal = typeFilter.value;
      const rarityVal = rarityFilter.value;

      let filtered = cards.slice();

      if (setVal) filtered = filtered.filter(c => c.setName === setVal);
      if (typeVal) filtered = filtered.filter(c => c.type === typeVal);
      if (rarityVal) filtered = filtered.filter(c => c.rarity === rarityVal);

      if (q) {
        filtered = filtered.filter(c => {
          const extra = c.extra || {};
          const vehicleTypes = Array.isArray(extra.vehicleTypes) ? extra.vehicleTypes.join(" ") : "";
          const vehicleType = extra.vehicleType || "";
          const levels = [extra.modLevel1, extra.modLevel2, extra.modLevel3, extra.modLevel4]
            .filter(Boolean)
            .join(" ");
          const hpCon = `${extra.hp ?? ""} ${extra.con ?? ""}`;

          const all =
            (c.name || "") + " " +
            (c.type || "") + " " +
            (c.rarity || "") + " " +
            (c.setName || "") + " " +
            (c.cardNumber || "") + " " +
            (c.notes || "") + " " +
            (c.tags || []).join(" ") + " " +
            (extra.modBasePart || "") + " " +
            vehicleTypes + " " +
            vehicleType + " " +
            levels + " " +
            hpCon;

          return all.toLowerCase().includes(q);
        });
      }

      cardCount.textContent = filtered.length.toString();

      grid.innerHTML = "";
      if (!filtered.length) {
        emptyState.style.display = "block";
        return;
      }
      emptyState.style.display = "none";

      const frag = document.createDocumentFragment();

      filtered.forEach(card => {
        const extra = card.extra || {};

        const cardEl = document.createElement("div");
        cardEl.className = "card";

        const thumb = document.createElement("div");
        thumb.className = "thumb";
        const img = document.createElement("img");
        img.src = card.imageData;
        img.alt = card.name || "Card";
        thumb.appendChild(img);

        const body = document.createElement("div");
        body.className = "body";

        const titleRow = document.createElement("div");
        titleRow.className = "title-row";

        const title = document.createElement("div");
        title.className = "title";
        title.textContent = card.name || "Untitled";

        const pill = document.createElement("div");
        pill.className = "pill";
        pill.textContent = card.type || "Unknown";

        titleRow.appendChild(title);
        titleRow.appendChild(pill);

        const meta1 = document.createElement("div");
        meta1.className = "meta";
        const setLabel = card.setName || "No Set";
        const num = card.cardNumber ? ` • #${card.cardNumber}` : "";
        meta1.textContent = `${setLabel}${num}`;

        const meta2 = document.createElement("div");
        meta2.className = "meta";
        meta2.textContent = "Rarity: " + (card.rarity || "—");

        body.appendChild(titleRow);
        body.appendChild(meta1);
        body.appendChild(meta2);

        // --- NEW: show extra info ---

        // Driver / Named Driver / Track → vehicleTypes
        if (
          (card.type === "Driver" ||
            card.type === "Named Driver" ||
            card.type === "Track") &&
          Array.isArray(extra.vehicleTypes) &&
          extra.vehicleTypes.length
        ) {
          const line = document.createElement("div");
          line.className = "extra-line";
          line.textContent = "Types: " + extra.vehicleTypes.join(", ");
          body.appendChild(line);
        }

        // Vehicles / Named Vehicles → vehicleType + HP/CON
        if (
          (card.type === "Vehicle" || card.type === "Named Vehicle") &&
          (extra.vehicleType || extra.hp != null || extra.con != null)
        ) {
          const line = document.createElement("div");
          line.className = "extra-line";
          const parts = [];
          if (extra.vehicleType) parts.push("Vehicle: " + extra.vehicleType);
          if (extra.hp != null || extra.con != null) {
            parts.push(`HP/CON: ${extra.hp ?? "-"} / ${extra.con ?? "-"}`);
          }
          line.textContent = parts.join(" • ");
          body.appendChild(line);
        }

        // Mods → base part + quick level summary
        if (
          card.type === "Mod" &&
          (extra.modBasePart ||
            extra.modLevel1 ||
            extra.modLevel2 ||
            extra.modLevel3 ||
            extra.modLevel4)
        ) {
          const line = document.createElement("div");
          line.className = "extra-line";
          let text = "";
          if (extra.modBasePart) {
            text += "Base Part: " + extra.modBasePart;
          }
          const levels = [extra.modLevel1, extra.modLevel2, extra.modLevel3, extra.modLevel4]
            .filter(Boolean);
          if (levels.length) {
            if (text) text += " • ";
            text += "Lv: " + levels.join(" | ");
          }
          line.textContent = text;
          body.appendChild(line);
        }

        // Tags
        if (card.tags && card.tags.length) {
          const tagLine = document.createElement("div");
          tagLine.className = "tag-line";
          card.tags.forEach(t => {
            const span = document.createElement("span");
            span.className = "tag-pill";
            span.textContent = t;
            tagLine.appendChild(span);
          });
          body.appendChild(tagLine);
        }

        // Rules snippet
        if (card.notes) {
          const notes = document.createElement("div");
          notes.className = "notes";
          notes.textContent = card.notes;
          body.appendChild(notes);
        }

        cardEl.appendChild(thumb);
        cardEl.appendChild(body);
        frag.appendChild(cardEl);
      });

      grid.appendChild(frag);
    }

    async function init() {
      await loadCards();
      populateFilters();
      render();

      searchInput.addEventListener("input", render);
      setFilter.addEventListener("change", render);
      typeFilter.addEventListener("change", render);
      rarityFilter.addEventListener("change", render);
    }

    init();
  </script>
</body>
</html>
