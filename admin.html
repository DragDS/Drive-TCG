<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DRIVE TCG Admin</title>

  <!-- SheetJS (XLSX) - REQUIRED for bulk import -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root{
      --bg:#06060b;
      --panel:#0b0b12;
      --panel2:#0a0a10;
      --text:#e9e9f2;
      --muted:#a6a6bf;
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.08);
      --accent:#ff8a2a;
      --accent2:#ff4d5a;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 30% 0%, rgba(255,138,42,.12), transparent 60%),
        radial-gradient(900px 450px at 70% 10%, rgba(255,77,90,.10), transparent 60%),
        var(--bg);
      min-height:100vh;
    }
    .wrap{
      width:min(1180px, calc(100% - 32px));
      margin:22px auto 36px;
    }

    /* Top header */
    .top-card{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:14px;
      padding:18px 18px 14px;
      box-shadow: 0 16px 60px rgba(0,0,0,.45);
    }
    .top-title{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .top-left h1{
      margin:2px 0 4px;
      letter-spacing:.12em;
      font-size:18px;
      font-weight:800;
    }
    .top-left .kicker{
      font-size:12px;
      color:var(--muted);
      margin:0 0 2px;
    }
    .pill-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .pill{
      font-size:11px;
      letter-spacing:.10em;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line2);
      background:rgba(0,0,0,.22);
      color:var(--muted);
      display:inline-flex;
      align-items:center;
      gap:6px;
      text-transform:uppercase;
    }
    .pill .dot{
      width:7px;
      height:7px;
      border-radius:999px;
      background:#2fe27d;
      box-shadow: 0 0 10px rgba(47,226,125,.6);
    }

    .btn{
      cursor:pointer;
      user-select:none;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      color:var(--text);
      border-radius:999px;
      padding:8px 12px;
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      transition:transform .05s ease, border-color .15s ease, background .15s ease;
      white-space:nowrap;
    }
    .btn:active{ transform:translateY(1px); }
    .btn.primary{
      border-color:rgba(255,138,42,.55);
      background:rgba(255,138,42,.12);
    }
    .btn.danger{
      border-color:rgba(255,77,90,.55);
      background:rgba(255,77,90,.10);
    }
    .btn.small{
      font-size:11px;
      padding:7px 10px;
    }

    /* Workspace */
    .workspace{
      margin-top:14px;
      background:linear-gradient(180deg, rgba(255,255,255,.035), rgba(255,255,255,.015));
      border:1px solid var(--line);
      border-radius:14px;
      padding:14px;
      box-shadow: 0 18px 70px rgba(0,0,0,.42);
    }
    .workspace-head{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      flex-wrap:wrap;
      padding:4px 2px 10px;
    }
    .workspace-head .title{
      display:flex;
      align-items:baseline;
      gap:10px;
      flex-wrap:wrap;
    }
    .workspace-head .title h2{
      margin:0;
      font-size:12px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:var(--muted);
      font-weight:800;
    }
    .workspace-head .subtitle{
      margin:0;
      font-size:12px;
      color:var(--muted);
    }

    .tabs{
      display:flex;
      gap:8px;
      padding:6px;
      border:1px solid var(--line2);
      background:rgba(0,0,0,.22);
      border-radius:999px;
    }
    .tab{
      border:1px solid transparent;
      background:transparent;
      color:var(--muted);
      padding:7px 10px;
      font-size:11px;
      letter-spacing:.10em;
      text-transform:uppercase;
      border-radius:999px;
      cursor:pointer;
      white-space:nowrap;
    }
    .tab.active{
      color:var(--text);
      border-color:rgba(255,138,42,.55);
      background:rgba(255,138,42,.12);
    }

    .section{ display:none; }
    .section.active{ display:block; }

    /* Shared panels */
    .panel{
      background:rgba(0,0,0,.24);
      border:1px solid var(--line2);
      border-radius:14px;
      padding:14px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
    }
    .grid2{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
    }
    @media (max-width: 980px){
      .grid2{ grid-template-columns:1fr; }
    }

    /* Bulk layout */
    .bulk-grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .bulk-grid{ grid-template-columns:1fr; }
    }

    .h3{
      margin:0 0 8px;
      font-size:16px;
      font-weight:800;
      letter-spacing:.02em;
    }
    .hint{
      margin:0 0 10px;
      font-size:12px;
      color:var(--muted);
      line-height:1.45;
    }
    .label{
      font-size:11px;
      letter-spacing:.10em;
      text-transform:uppercase;
      color:var(--muted);
      margin:10px 0 6px;
    }

    select, input[type="text"]{
      width:100%;
      border-radius:10px;
      border:1px solid var(--line2);
      background:rgba(0,0,0,.28);
      color:var(--text);
      padding:9px 10px;
      outline:none;
    }

    .row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .row > *{ flex:1; }
    .row .tight{ flex:0 0 auto; }

    .status{
      margin-top:10px;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid var(--line2);
      background:rgba(0,0,0,.22);
      color:var(--muted);
      font-size:12px;
      min-height:38px;
      display:flex;
      align-items:center;
    }

    /* PATCH: prevent infinite height, scroll inside list boxes */
    #bulkSelectionList,
    #bulkSelectedPreview{
      margin:0;
      padding:0.25rem 0.5rem;
      list-style:none;
      background:#050509;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.08);
      max-height: calc(100vh - 360px);
      overflow-y:auto;
      font-family:var(--mono);
      font-size:11px;
      line-height:1.4;
    }
    #bulkSelectedPreview{
      white-space:pre-wrap;
      padding:10px 12px;
      list-style:none;
    }
    #bulkSelectionList li.bulk-row{
      display:flex;
      align-items:center;
      gap:8px;
      padding:4px 2px;
      border-bottom:1px dashed rgba(255,255,255,.06);
    }
    #bulkSelectionList li.bulk-row:last-child{ border-bottom:none; }
    #bulkSelectionList li.bulk-row .bulk-row-label{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      color:var(--text);
    }

    /* Buttons footer */
    .bulk-actions{
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .bulk-actions .btn{ flex:1; }
    .bulk-actions .btn.tight{ flex:0 0 auto; }

    /* Minimal placeholder styles for other sections */
    .placeholder{
      color:var(--muted);
      font-size:13px;
      line-height:1.5;
    }

    /* Modal */
    #modalBackdrop{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,.60);
      z-index:50;
      padding:18px;
    }
    #modalBackdrop.active{ display:flex; }
    .modal{
      width:min(520px, 100%);
      border-radius:14px;
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      padding:14px;
      box-shadow: 0 26px 90px rgba(0,0,0,.60);
    }
    .modal h3{ margin:0 0 8px; }
    .modal p{ margin:0 0 12px; color:var(--muted); }
    .modal .row{ justify-content:flex-end; }
    .modal .row .btn{ flex:0 0 auto; }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- Header -->
    <div class="top-card">
      <div class="top-title">
        <div class="top-left">
          <div class="kicker">DRIVE TCG Admin</div>
          <h1>ADMIN TOOLKIT</h1>
          <div class="pill-row">
            <span class="pill"><span class="dot"></span> single-file json • no server</span>
            <span class="pill">changes are live in memory</span>
            <span class="pill">use export json to save your edits</span>
          </div>
        </div>

        <div class="top-right" style="display:flex; gap:10px; flex-wrap:wrap;">
          <button class="btn" id="downloadCardsJsonBtn">Export Card JSON</button>
          <button class="btn" id="downloadPreconsJsonBtn">Export Precon JSON</button>
        </div>
      </div>
    </div>

    <!-- Workspace -->
    <div class="workspace">
      <div class="workspace-head">
        <div class="title">
          <h2>Workspace</h2>
          <p class="subtitle">Use the tabs to switch between Single Card, Bulk Import, and Precon Decks.</p>
        </div>

        <div class="tabs" aria-label="Workspace navigation">
          <button class="tab active" id="navSingleBtn">Single Card</button>
          <button class="tab" id="navBulkBtn">Bulk Import</button>
          <button class="tab" id="navPreconsBtn">Precons</button>
          <button class="tab" id="navHelpBtn">Help</button>
        </div>
      </div>

      <!-- SINGLE -->
      <section class="section active" id="singleSection">
        <div class="panel">
          <div class="h3">Single Card</div>
          <p class="hint">Single editor UI is handled by your existing Single module. (No changes required here for the bulk patch.)</p>

          <!-- Keep your existing Single HTML here if you already have it.
               Minimal placeholders below so the page still loads if you paste this fresh file. -->

          <div class="grid2">
            <div class="panel" style="background:rgba(0,0,0,.18)">
              <div class="label">Editor</div>
              <div class="placeholder">
                If you already have a full Single Editor section, paste it here and keep the element IDs
                used by <code>dom.js</code> and <code>single.js</code>.
              </div>

              <!-- basic buttons (IDs used by app.js / single.js) -->
              <div class="bulk-actions" style="margin-top:12px;">
                <button class="btn primary" id="downloadCardsJsonBtn_single">Export Card JSON</button>
                <button class="btn" id="singleSaveBtn">Save</button>
                <button class="btn" id="singleNewBtn">New</button>
                <button class="btn danger" id="singleDeleteBtn">Delete</button>
              </div>

              <div class="status" id="singleStatus">Single status…</div>
            </div>

            <div class="panel" style="background:rgba(0,0,0,.18)">
              <div class="label">Preview</div>
              <div id="singlePreview" class="placeholder">Single preview renders here…</div>

              <div class="label" style="margin-top:12px;">Library</div>
              <input id="cardLibrarySearchInput" type="text" placeholder="Search cards…" />
              <div class="status" style="margin-top:8px;">
                <span id="libraryCount">0 cards</span>
              </div>
              <ul id="cardLibraryList" style="margin:8px 0 0; padding:0; list-style:none;"></ul>
            </div>
          </div>

          <!-- Hidden inputs referenced by dom.js/single.js; include if your current admin.html already has them.
               If your existing file already includes them, keep yours and delete these. -->
          <input id="cardIdInput" type="hidden">
          <input id="cardNameInput" type="hidden">
          <input id="cardTypeInput" type="hidden">
          <input id="cardSetNameInput" type="hidden">
          <input id="cardNumberInput" type="hidden">
          <input id="cardRarityInput" type="hidden">
          <input id="cardVehicleTypesInput" type="hidden">
          <input id="cardTagsInput" type="hidden">
          <input id="cardImageUrlInput" type="hidden">
          <input id="modBasePartInput" type="hidden">
          <input id="modL1Input" type="hidden">
          <input id="modL2Input" type="hidden">
          <input id="modL3Input" type="hidden">
          <input id="modL4Input" type="hidden">
          <input id="vehicleHpConInput" type="hidden">
          <input id="vehiclePitCostInput" type="hidden">
          <textarea id="cardNotesInput" style="display:none"></textarea>

          <select id="printSetSelect" style="display:none"></select>
          <input id="printCustomSetInput" type="hidden">
          <input id="printCardNumberInput" type="hidden">
          <button id="printSetPrimaryBtn" style="display:none"></button>
          <button id="printClearAllBtn" style="display:none"></button>
          <ul id="printsList" style="display:none"></ul>
        </div>
      </section>

      <!-- BULK -->
      <section class="section" id="bulkSection">
        <div class="panel">
          <div class="h3">Bulk Import</div>
          <p class="hint">
            Load from your master spreadsheet, filter by Type/Set (supports cards in multiple sets like “SET 1 &amp; 3”),
            select what you want, then import into the JSON library.
          </p>

          <div class="bulk-grid">
            <!-- Step 1 -->
            <div class="panel" style="background:rgba(0,0,0,.18)">
              <div class="h3" style="font-size:18px;">Step 1 · Load master spreadsheet</div>
              <div class="label">Drive master file (.xlsx)</div>
              <input type="file" id="bulkFileInput" accept=".xlsx" />

              <div class="status" id="bulkStatus" style="margin-top:10px;">
                Select Drive Cards.xlsx to begin.
              </div>
            </div>

            <!-- Step 2 & 3 -->
            <div class="panel" style="background:rgba(0,0,0,.18)">
              <div class="h3" style="font-size:18px;">Step 2 · Filter &amp; choose cards</div>

              <div class="row">
                <div>
                  <div class="label">Filter by Type</div>
                  <select id="bulkFilterTypeSelect">
                    <option value="__ALL__">All Types</option>
                  </select>
                </div>
                <div>
                  <div class="label">Filter by Set</div>
                  <select id="bulkFilterSetSelect">
                    <option value="__ALL__">All Sets</option>
                  </select>
                </div>
              </div>

              <div class="row" style="margin-top:10px;">
                <button class="btn small" id="bulkSelectAllViewedBtn">Select all viewed</button>
                <button class="btn small" id="bulkDeselectAllViewedBtn">Deselect all viewed</button>
              </div>

              <div class="label" style="margin-top:12px;">Cards (check to include in Step 3)</div>
              <ul id="bulkSelectionList"></ul>

              <div class="h3" style="font-size:18px; margin-top:14px;">Step 3 · Review &amp; import</div>
              <div class="label">Selected cards</div>
              <div id="bulkSelectedPreview">No cards selected for import.</div>

              <div class="bulk-actions">
                <button class="btn primary" id="bulkImportBtn">Import selected into library</button>
                <button class="btn danger" id="bulkClearSessionBtn">Clear current bulk session</button>
              </div>
            </div>
          </div>

        </div>
      </section>

      <!-- PRECONS -->
      <section class="section" id="preconsSection">
        <div class="panel">
          <div class="h3">Precons</div>
          <p class="placeholder">Your Precons UI goes here.</p>
          <div id="preconsStatus" class="status">Precons status…</div>
          <div id="preconGrid"></div>
        </div>
      </section>

      <!-- HELP -->
      <section class="section" id="helpSection">
        <div class="panel">
          <div class="h3">Help</div>
          <p class="placeholder">
            Bulk Import reads Drive Cards.xlsx, builds cards from each sheet, then lets you filter and import.
          </p>
        </div>
      </section>
    </div>
  </div>

  <!-- Modal (shared) -->
  <div id="modalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Confirm</h3>
      <p id="modalBody">Are you sure?</p>
      <div class="row">
        <button class="btn" id="modalCancelBtn">Cancel</button>
        <button class="btn primary" id="modalConfirmBtn">Confirm</button>
      </div>
    </div>
  </div>

  <!-- App entry -->
  <script type="module" src="./app.js"></script>
</body>
</html>
